<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta charset="utf8" />
<title>zkREPL Demo App</title>
<style>
    * {
        box-sizing: border-box;
    }
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
            Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }
    .main {
        padding: 20px;
        margin: 0 auto;
        max-width: 500px;
    }

    .banner {
        background: linear-gradient(#673ab7, #344395);
        color: white;
        padding: 20px;
        border-bottom: 1px solid #e0e0e0;
        text-align: center;
    }

    #proofData {
        width: 100%;
        height: 150px;
        display: block;
        margin-bottom: 10px;
        padding: 10px;
    }

    #publicSignals {
        width: 100%;
        height: 50px;
        display: block;
        margin-bottom: 10px;
        padding: 10px;
    }
    button {
        display: block;
        width: 100%;
        background: #ef8e00;
        border: 0;
        color: white;
        padding: 10px;
        border-radius: 10px;
        font-weight: bold;
        font-size: inherit;
        cursor: pointer;
    }
    #result {
        margin-top: 10px;
    }
</style>

<div class="banner">
    This is a demo application automatically generated by zkREPL.
</div>
<div class="main">
    <h4>Inputs</h4>

    <div>a: <input type="text" id="input_a" value="33" /></div>
    <br />
    <div>b: <input id="input_b" type="text" value="12" /></div>

    <h4>Proof</h4>

    <button onclick="calculateProof()">Generate Proof</button>

    <div id="proof"></div>
    <h4>Verify</h4>
    <textarea
        id="proofData"
        placeholder="Click 'Generate Proof' to generate a proof"
    ></textarea>

    <textarea placeholder="Public signals..." id="publicSignals"></textarea>
    <button onclick="verifyProof()">Verify Proof</button>

    <div id="result"></div>

    <h4>Audit</h4>

    <p>
        Upload the ZKey to zkREPL to confirm that the current proving key
        matches the source code for the claimed circuit
    </p>
    <button onclick="downloadZKey()">Download ZKey</button>
</div>
<script src="snarkjs.min.js"></script>

<script>
    async function calculateProof() {
        const { proof, publicSignals } = await snarkjs.groth16.fullProve(
            {
                a: document.getElementById("input_a").value,
                b: document.getElementById("input_b").value,
            },
            WASM_URL,
            ZKEY_DATA
        )

        document.getElementById("proofData").value = JSON.stringify(proof)
        document.getElementById("publicSignals").value =
            JSON.stringify(publicSignals)
    }

    async function verifyProof() {
        const publicSignals = JSON.parse(
            document.getElementById("publicSignals").value
        )
        const proof = JSON.parse(document.getElementById("proofData").value)

        const res = await snarkjs.groth16.verify(
            VKEY_DATA,
            publicSignals,
            proof
        )

        document.getElementById("result").innerHTML = res
            ? "✅ Proof is valid"
            : "❌ Proof is invalid"
    }

    async function downloadZKey() {
        const a = document.createElement("a")
        a.href = ZKEY_DATA
        a.download = "main.zkey"
        a.click()
    }
</script>

<script>
    const VKEY_DATA = {{VKEY_DATA}}
</script>

<script>
    /* {{SNARKJS}} */
</script>

<script>
    const ZKEY_DATA = "{{ZKEY_DATA}}"
</script>

<script>
    const WASM_URL = "{{WASM_URL}}"
</script>
